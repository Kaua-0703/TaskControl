<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <title>Dashboard</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>

<body class="bg-light p-3">

    <table class="table mb-3">
        <tr>
            <td class="text-start">
                <a href="novatarefa.html" class="btn btn-primary">
                    Adicionar tarefa
                </a>
            </td>
            <td class="text-end">
                <a href="dashboardusuario.html" class="btn btn-secondary">
                    Usuários
                </a>
            </td>
        </tr>
    </table>

    <table class="table table-hover shadow-sm bg-white" id="tabelaTarefas">
        <thead>
            <tr>
                <th>Id</th>
                <th>Usuário</th>
                <th>Título</th>
                <th>Descrição</th>
                <th>Data criação</th>
                <th>Data limite</th>
                <th>Status</th>
            </tr>
        </thead>

        <tbody id="corpoTarefas">
            <tr></tr>
        </tbody>
    </table>

    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>

    <script>
        function carregarTarefas() {
            fetch("api/tarefa.php?acao=listar")
                .then(r => r.text())
                .then(html => {
                    document.getElementById("corpoTarefas").innerHTML = html;
                });
        }

        carregarTarefas();

        function excluirTarefa(id) {

            if (!confirm("Tem certeza que deseja excluir esta tarefa?")) {
                return;
            }

            $.ajax({
                url: "api/tarefa.php?acao=excluir",
                method: "POST",
                data: {
                    id: id
                },
                dataType: "text"
            })
            .done(function (res) {
                if (res.trim() === "OK") {
                    carregarTarefas();
                } else {
                    alert("Erro ao excluir tarefa. " + res);
                }
            })
            .fail(function (xhr) {
                var txt = xhr.responseText && xhr.responseText.trim() !== ""
                    ? xhr.responseText
                    : "Erro ao excluir tarefa.";

                alert(txt);
            });
        }

        function concluirTarefa(id) {
            if (!confirm("Marcar esta tarefa como concluída?")) {
                return;
            }

            $.ajax({
                url: "api/tarefa.php?acao=concluir",
                method: "POST",
                data: { id: id },
                dataType: "text"
            })
            .done(function (res) {
                if (res.trim() === "OK") {
                    carregarTarefas();
                } else {
                    alert(res);
                }
            })
            .fail(function () {
                alert("Erro ao concluir tarefa.");
            });
        }
    </script>

</body>
</html>
