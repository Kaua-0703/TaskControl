<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <title>Dashboard</title>

    <meta name="viewport" content="width=device-width, initial-scale=1">

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>

<body class="bg-light p-3">

    <div class="table-responsive">
        <table class="table table-hover bg-white shadow-sm w-100">
            <thead class="table-light">
                <tr>
                    <th>ID</th>
                    <th>Usuário</th>
                    <th>Título</th>
                    <th>Descrição</th>
                    <th>Criação</th>
                    <th>Limite</th>
                    <th>Status</th>
                    <th class="text-end">Ações</th>
                </tr>
            </thead>
            <tbody id="corpoTarefas"></tbody>
        </table>
    </div>

    <div class="d-flex justify-content-center align-items-center gap-3 mt-3">
        <button id="btnAnterior" class="btn btn-secondary btn-sm"
            onclick="carregarTarefas(paginaAtual - 1)">
            ⬅ Anterior
        </button>

        <span class="fw-semibold">
            Página <span id="paginaAtualTexto">1</span>
        </span>

        <button class="btn btn-secondary btn-sm"
            onclick="carregarTarefas(paginaAtual + 1)">
            Próxima ➡
        </button>
    </div>

    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>

    <script>
        let paginaAtual = 1;

        function carregarTarefas(pagina = 1) {
            if (pagina < 1) return;

            paginaAtual = pagina;

            fetch(`api/tarefa.php?acao=listar&pagina=${pagina}`)
                .then(response => response.text())
                .then(html => {
                    document.getElementById("corpoTarefas").innerHTML = html;

                    document.getElementById("paginaAtualTexto").innerText = paginaAtual;

                    document.getElementById("btnAnterior").disabled = paginaAtual === 1;
                });
        }

        carregarTarefas();

        function excluirTarefa(id) {
            if (!confirm("Deseja excluir esta tarefa?")) return;

            $.post("api/tarefa.php?acao=excluir", { id })
                .done(() => carregarTarefas(paginaAtual))
                .fail(() => alert("Erro ao excluir a tarefa"));
        }

        function concluirTarefa(id) {
            if (!confirm("Marcar tarefa como concluída?")) return;

            $.post("api/tarefa.php?acao=concluir", { id })
                .done(() => carregarTarefas(paginaAtual))
                .fail(() => alert("Erro ao concluir a tarefa"));
        }
    </script>

</body>

</html>
