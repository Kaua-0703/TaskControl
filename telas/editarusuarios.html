<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <title>Editar Usuário</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>

<body class="bg-light p-4">

    <h5 class="mb-3">Editar Usuário</h5>

    <form id="formEditarUsuario">
        <input type="hidden" id="id">

        <label>Nome</label>
        <input type="text" id="nome" class="form-control">

        <label>Email</label>
        <input type="email" id="email" class="form-control">

        <label class="form-check mt-2">
            <input type="checkbox" id="admin" class="form-check-input">
            Administrador
        </label>

        <button class="btn btn-warning mt-3" id="btnSalvar">
            Salvar alterações
        </button>
        <a href="dashboardusuario.html" class="btn btn-secondary ms-2">
            Voltar
        </a>
    </form>

    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>

    <script>
        $(function () {

            var id = window.location.search.replace("?id=", "");

            $.ajax({
                url: "api/usuario.php?acao=buscar",
                method: "POST",
                data: {
                    id: id
                },
                dataType: "json"
            })
                .done(function (u) {
                    $("#id").val(u.id);
                    $("#nome").val(u.nome);
                    $("#email").val(u.email);
                    $("#admin").prop("checked", u.admin == 1);
                })
                .fail(function () {
                    $("#msg").removeClass("d-none")
                        .text("Erro ao carregar usuário.");
                });

            $("#btnSalvar").on("click", function (e) {
                e.preventDefault();

                $("#msg").addClass("d-none").text("");

                var nome = $("#nome").val().trim();
                var email = $("#email").val().trim();
                var admin = $("#admin").is(":checked");

                $.ajax({
                    url: "api/usuario.php?acao=atualizar",
                    method: "POST",
                    data: {
                        id: id,
                        nome: nome,
                        email: email,
                        admin: admin
                    },
                    dataType: "text"
                })
                    .done(function (res) {
                        if (res.trim() === "OK") {
                            window.location.href = "dashboardusuario.html";
                        } else {
                            $("#msg").removeClass("d-none")
                                .text("Erro ao editar usuário." + res);
                        }
                    })
                    .fail(function (xhr) {
                        var txt = xhr.responseText && xhr.responseText.trim() !== ""
                            ? xhr.responseText
                            : "Erro ao editar usuário.";

                        $("#msg").removeClass("d-none").text(txt);
                    })
                    .always(function () {
                        $("#btnSalvar").prop("disabled", false)
                            .text("Salvar alterações");
                    });

            });

        });
    </script>



</body>

</html>